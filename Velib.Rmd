---
title: "Velib availability"
output: 
  html_document: 
    css: "style.css"
---

```{r include=FALSE}
library(httr)
require(httr)
library(jsonlite)
require(jsonlite)
library(leaflet)
library(dplyr)

urlStatus <- "https://velib-metropole-opendata.smoove.pro/opendata/Velib_Metropole/station_status.json"
urlInformations <- "https://velib-metropole-opendata.smoove.pro/opendata/Velib_Metropole/station_information.json"

status <- GET(urlStatus, verbose())
status_text <- content(status, "text")
status_json <- fromJSON(status_text, flatten = TRUE)
status_df <- as.data.frame(status_json)

info <- GET(urlInformations, verbose())
info_text <- content(info, "text")
info_json <- fromJSON(info_text, flatten = TRUE)
info_df <- as.data.frame(info_json)

velib = left_join(info_df, status_df, by="data.stations.stationCode")
totalVelibAvailable <- sum(velib$data.stations.num_bikes_available) / sum(velib$data.stations.capacity) * 100
totalDocksAvailable <- sum(velib$data.stations.num_docks_available) / sum(velib$data.stations.capacity) * 100

pal <- colorFactor (c("#FF0000FF", "#FFFF00FF", "#00FF00FF", "#00FFFFFF", "#0000FFFF", "#FF00FFFF"), domain = velib$data.stations.capacity)

popup_info = paste(velib$data.stations.name, "<br/>", "Capacité maximale de la station : ", velib$data.stations.capacity, "<br/>", "Vélos disponibles actuellement : ", velib$data.stations.num_bikes_available) 
```

![velib-logo](Velib-Metropole-Logo.png){#id .img width=193px height=118.8px}
<h1> Paris area's velib stations cartography : </h1>

```{r echo=FALSE}
leaflet()%>%addTiles()%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))


```

<h2> Rayan </h2>
Autres templates de map possibles :
```{r echo=FALSE}
leaflet()%>%addProviderTiles(providers$Stamen.Toner)%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))
leaflet()%>%addProviderTiles(providers$CartoDB.Positron)%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))
leaflet()%>%addProviderTiles(providers$Esri.NatGeoWorldMap)%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))
leaflet()%>%addProviderTiles(providers$MtbMap) %>%
  addProviderTiles(providers$Stamen.TonerLines,
    options = providerTileOptions(opacity = 0.35)) %>%
  addProviderTiles(providers$Stamen.TonerLabels)%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))


leaflet()%>%addTiles()%>%addMarkers(data=velib, lat = ~data.stations.lat, lng = ~data.stations.lon, popup = ~popup_info, clusterOptions = markerClusterOptions(iconCreateFunction =
                                      JS("
                                          function(cluster) {
                                             return new L.DivIcon({
                                               html: '<div style=\"color:white; background-color:rgba(0,147,255,1)\"><span>' + cluster.getChildCount() + '</div><span>',
                                               className: 'marker-cluster'
                                             }); 
                                           }")))


```


`r totalVelibAvailable`

<h2> Abdel </h2>
```{r}


```


<h2> Karine </h2>
```{r}

```

<h2> Mohamed </h2>
```{r}

```


<h2> Mathieu </h2>
```{r}

```

